---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro'; // The main site layout
import BlogPost from '../../layouts/BlogPost.astro'; // The simplified article layout

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter((post) => post.slug)
    .map((post) => ({
      params: { slug: post.slug },
      props: post,
    }));
}

const currentPost = Astro.props;
const { Content } = await currentPost.render();

const allPosts = await getCollection('blog');
const otherPosts = allPosts
  .filter((post) => post.slug !== currentPost.slug)
  .sort(() => Math.random() - 0.5)
  .slice(0, 3);
---
<Layout title={currentPost.data.title}>
  
  <BlogPost frontmatter={currentPost.data}>
    <Content />
  </BlogPost>

  <section class="max-w-5xl mx-auto px-6 py-12 md:py-20 border-t border-slate-700">
    <h2 class="text-3xl font-bold text-slate-100 mb-8 text-center">
      More Articles
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {otherPosts.map((post) => (
        <a 
          href={`/blog/${post.slug}/`} 
          class="block bg-slate-800 rounded-2xl border border-slate-700 hover:border-blue-600 hover:-translate-y-1 transition-all group"
        >
          <img 
            src={post.data.heroImage} 
            alt="" 
            class="rounded-t-2xl aspect-video object-cover w-full" 
          />
          <div class="p-6">
            <h3 class="text-xl font-bold text-slate-100 group-hover:text-blue-400">
              {post.data.title}
            </h3>
          </div>
        </a>
      ))}
    </div>
  </section>

</Layout>